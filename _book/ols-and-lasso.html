<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 OLS and lasso | Machine Learning in R</title>
  <meta name="description" content="D-Lab’s Machine Learning in R Workshop" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 OLS and lasso | Machine Learning in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="D-Lab’s Machine Learning in R Workshop" />
  <meta name="github-repo" content="dlab-berkeley/Machine-Learning-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 OLS and lasso | Machine Learning in R" />
  
  <meta name="twitter:description" content="D-Lab’s Machine Learning in R Workshop" />
  



<meta name="date" content="2020-09-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preprocessing.html"/>
<link rel="next" href="decision-trees.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Machine Learning in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prereqs"><i class="fa fa-check"></i><b>1.1</b> Prereqs</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#package-installation"><i class="fa fa-check"></i><b>2.1</b> Package installation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>3</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>3.1</b> Load packages</a></li>
<li class="chapter" data-level="3.2" data-path="preprocessing.html"><a href="preprocessing.html#load-the-data"><i class="fa fa-check"></i><b>3.2</b> Load the data</a></li>
<li class="chapter" data-level="3.3" data-path="preprocessing.html"><a href="preprocessing.html#read-background-information-and-variable-descriptions"><i class="fa fa-check"></i><b>3.3</b> Read background information and variable descriptions</a></li>
<li class="chapter" data-level="3.4" data-path="preprocessing.html"><a href="preprocessing.html#quick-overviews-on-machine-learning"><i class="fa fa-check"></i><b>3.4</b> Quick overviews on machine learning</a></li>
<li class="chapter" data-level="3.5" data-path="preprocessing.html"><a href="preprocessing.html#machine-learning-workflow"><i class="fa fa-check"></i><b>3.5</b> Machine learning workflow</a></li>
<li class="chapter" data-level="3.6" data-path="preprocessing.html"><a href="preprocessing.html#why-taking-a-tidyverse-approach-to-machine-learning"><i class="fa fa-check"></i><b>3.6</b> Why taking a tidyverse approach to machine learning?</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="preprocessing.html"><a href="preprocessing.html#benefits"><i class="fa fa-check"></i><b>3.6.1</b> Benefits</a></li>
<li class="chapter" data-level="3.6.2" data-path="preprocessing.html"><a href="preprocessing.html#tidymodels"><i class="fa fa-check"></i><b>3.6.2</b> tidymodels</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="preprocessing.html"><a href="preprocessing.html#data-preprocessing"><i class="fa fa-check"></i><b>3.7</b> Data preprocessing</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="preprocessing.html"><a href="preprocessing.html#task-1-what-is-one-hot-encoding"><i class="fa fa-check"></i><b>3.7.1</b> Task 1: What is one-hot encoding?</a></li>
<li class="chapter" data-level="3.7.2" data-path="preprocessing.html"><a href="preprocessing.html#task-2-handling-missing-data"><i class="fa fa-check"></i><b>3.7.2</b> Task 2: Handling missing data</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="preprocessing.html"><a href="preprocessing.html#preprocessing-workflow"><i class="fa fa-check"></i><b>3.8</b> Preprocessing workflow</a></li>
<li class="chapter" data-level="3.9" data-path="preprocessing.html"><a href="preprocessing.html#regressioin-setup"><i class="fa fa-check"></i><b>3.9</b> Regressioin setup</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="preprocessing.html"><a href="preprocessing.html#outcome-variable"><i class="fa fa-check"></i><b>3.9.1</b> Outcome variable</a></li>
<li class="chapter" data-level="3.9.2" data-path="preprocessing.html"><a href="preprocessing.html#data-splitting-using-random-sampling"><i class="fa fa-check"></i><b>3.9.2</b> Data splitting using random sampling</a></li>
<li class="chapter" data-level="3.9.3" data-path="preprocessing.html"><a href="preprocessing.html#recipe"><i class="fa fa-check"></i><b>3.9.3</b> recipe</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="preprocessing.html"><a href="preprocessing.html#classification-setup"><i class="fa fa-check"></i><b>3.10</b> Classification setup</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="preprocessing.html"><a href="preprocessing.html#outcome-variable-1"><i class="fa fa-check"></i><b>3.10.1</b> Outcome variable</a></li>
<li class="chapter" data-level="3.10.2" data-path="preprocessing.html"><a href="preprocessing.html#data-splitting-using-stratified-random-sampling"><i class="fa fa-check"></i><b>3.10.2</b> Data splitting using stratified random sampling</a></li>
<li class="chapter" data-level="3.10.3" data-path="preprocessing.html"><a href="preprocessing.html#recipe-1"><i class="fa fa-check"></i><b>3.10.3</b> recipe</a></li>
<li class="chapter" data-level="3.10.4" data-path="preprocessing.html"><a href="preprocessing.html#save-our-preprocessed-data"><i class="fa fa-check"></i><b>3.10.4</b> Save our preprocessed data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html"><i class="fa fa-check"></i><b>4</b> OLS and lasso</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>4.1</b> Load packages</a></li>
<li class="chapter" data-level="4.2" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#load-data"><i class="fa fa-check"></i><b>4.2</b> Load data</a></li>
<li class="chapter" data-level="4.3" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>4.3</b> Overview</a></li>
<li class="chapter" data-level="4.4" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#fit-and-evaluate-models"><i class="fa fa-check"></i><b>4.4</b> Fit and evaluate models</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#non-tidy"><i class="fa fa-check"></i><b>4.4.1</b> Non-tidy</a></li>
<li class="chapter" data-level="4.4.2" data-path="preprocessing.html"><a href="preprocessing.html#tidymodels"><i class="fa fa-check"></i><b>4.4.2</b> tidymodels</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#tuning-parameters"><i class="fa fa-check"></i><b>4.5</b> Tuning parameters</a></li>
<li class="chapter" data-level="4.6" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#challenge-1"><i class="fa fa-check"></i><b>4.6</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>5</b> Decision Trees</a>
<ul>
<li class="chapter" data-level="5.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>5.1</b> Load packages</a></li>
<li class="chapter" data-level="5.2" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#load-data"><i class="fa fa-check"></i><b>5.2</b> Load data</a></li>
<li class="chapter" data-level="5.3" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>5.3</b> Overview</a></li>
<li class="chapter" data-level="5.4" data-path="decision-trees.html"><a href="decision-trees.html#fit-model"><i class="fa fa-check"></i><b>5.4</b> Fit Model</a></li>
<li class="chapter" data-level="5.5" data-path="decision-trees.html"><a href="decision-trees.html#investigate-results"><i class="fa fa-check"></i><b>5.5</b> Investigate Results</a></li>
<li class="chapter" data-level="5.6" data-path="decision-trees.html"><a href="decision-trees.html#challenge-2"><i class="fa fa-check"></i><b>5.6</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="random-forests.html"><a href="random-forests.html"><i class="fa fa-check"></i><b>6</b> Random Forests</a>
<ul>
<li class="chapter" data-level="6.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>6.1</b> Load packages</a></li>
<li class="chapter" data-level="6.2" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#load-data"><i class="fa fa-check"></i><b>6.2</b> Load data</a></li>
<li class="chapter" data-level="6.3" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>6.3</b> Overview</a></li>
<li class="chapter" data-level="6.4" data-path="decision-trees.html"><a href="decision-trees.html#fit-model"><i class="fa fa-check"></i><b>6.4</b> Fit model</a></li>
<li class="chapter" data-level="6.5" data-path="decision-trees.html"><a href="decision-trees.html#investigate-results"><i class="fa fa-check"></i><b>6.5</b> Investigate Results</a></li>
<li class="chapter" data-level="6.6" data-path="random-forests.html"><a href="random-forests.html#challenge-3"><i class="fa fa-check"></i><b>6.6</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="xgboost.html"><a href="xgboost.html"><i class="fa fa-check"></i><b>7</b> XGBoost</a>
<ul>
<li class="chapter" data-level="7.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>7.1</b> Load packages</a></li>
<li class="chapter" data-level="7.2" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#load-data"><i class="fa fa-check"></i><b>7.2</b> Load data</a></li>
<li class="chapter" data-level="7.3" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>7.3</b> Overview</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="xgboost.html"><a href="xgboost.html#define-cv_control"><i class="fa fa-check"></i><b>7.3.1</b> Define <code>cv_control</code></a></li>
<li class="chapter" data-level="7.3.2" data-path="xgboost.html"><a href="xgboost.html#define-xgb_grid"><i class="fa fa-check"></i><b>7.3.2</b> Define <code>xgb_grid</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="decision-trees.html"><a href="decision-trees.html#fit-model"><i class="fa fa-check"></i><b>7.4</b> Fit model</a></li>
<li class="chapter" data-level="7.5" data-path="decision-trees.html"><a href="decision-trees.html#investigate-results"><i class="fa fa-check"></i><b>7.5</b> Investigate Results</a></li>
<li class="chapter" data-level="7.6" data-path="xgboost.html"><a href="xgboost.html#challenge-4"><i class="fa fa-check"></i><b>7.6</b> Challenge 4</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ensembles.html"><a href="ensembles.html"><i class="fa fa-check"></i><b>8</b> Ensembles</a>
<ul>
<li class="chapter" data-level="8.1" data-path="preprocessing.html"><a href="preprocessing.html#load-packages"><i class="fa fa-check"></i><b>8.1</b> Load packages</a></li>
<li class="chapter" data-level="8.2" data-path="ols-and-lasso.html"><a href="ols-and-lasso.html#load-data"><i class="fa fa-check"></i><b>8.2</b> Load data</a></li>
<li class="chapter" data-level="8.3" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>8.3</b> Overview</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="ensembles.html"><a href="ensembles.html#choose-algorithms"><i class="fa fa-check"></i><b>8.3.1</b> Choose algorithms</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="decision-trees.html"><a href="decision-trees.html#fit-model"><i class="fa fa-check"></i><b>8.4</b> Fit Model</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="ensembles.html"><a href="ensembles.html#risk"><i class="fa fa-check"></i><b>8.4.1</b> Risk</a></li>
<li class="chapter" data-level="8.4.2" data-path="ensembles.html"><a href="ensembles.html#plot-the-risk"><i class="fa fa-check"></i><b>8.4.2</b> Plot the risk</a></li>
<li class="chapter" data-level="8.4.3" data-path="ensembles.html"><a href="ensembles.html#compute-auc-for-all-estimators"><i class="fa fa-check"></i><b>8.4.3</b> Compute AUC for all estimators</a></li>
<li class="chapter" data-level="8.4.4" data-path="ensembles.html"><a href="ensembles.html#plot-the-roc-curve-for-the-best-estimator"><i class="fa fa-check"></i><b>8.4.4</b> Plot the ROC curve for the best estimator</a></li>
<li class="chapter" data-level="8.4.5" data-path="ensembles.html"><a href="ensembles.html#review-weight-distribution-for-the-superlearner"><i class="fa fa-check"></i><b>8.4.5</b> Review weight distribution for the SuperLearner</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="ensembles.html"><a href="ensembles.html#challenge-5"><i class="fa fa-check"></i><b>8.5</b> Challenge 5</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>9</b> Principal Component Analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#unsupervised-approaches"><i class="fa fa-check"></i><b>9.1</b> Unsupervised approaches</a></li>
<li class="chapter" data-level="9.2" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#reclass-variables"><i class="fa fa-check"></i><b>9.2</b> Reclass variables</a></li>
<li class="chapter" data-level="9.3" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#scale-numeric-variables"><i class="fa fa-check"></i><b>9.3</b> Scale numeric variables</a></li>
<li class="chapter" data-level="9.4" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#factorize-categorical-variables"><i class="fa fa-check"></i><b>9.4</b> Factorize categorical variables</a></li>
<li class="chapter" data-level="9.5" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#screeplot"><i class="fa fa-check"></i><b>9.5</b> Screeplot</a></li>
<li class="chapter" data-level="9.6" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#ggplot-coordinates"><i class="fa fa-check"></i><b>9.6</b> ggplot coordinates</a></li>
<li class="chapter" data-level="9.7" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#view-factor-loadings"><i class="fa fa-check"></i><b>9.7</b> View factor loadings</a></li>
<li class="chapter" data-level="9.8" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#generate-predicted-values-of-pcs-for-test-dataset"><i class="fa fa-check"></i><b>9.8</b> Generate predicted values of PCs for test dataset</a></li>
<li class="chapter" data-level="9.9" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#define-plotting-parameters"><i class="fa fa-check"></i><b>9.9</b> Define plotting parameters</a></li>
<li class="chapter" data-level="9.10" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#store-the-scores-inside-of-dataframes"><i class="fa fa-check"></i><b>9.10</b> Store the scores inside of dataframes</a></li>
<li class="chapter" data-level="9.11" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#save-ml_num-for-use-in-09-hclust.rmd"><i class="fa fa-check"></i><b>9.11</b> Save <code>ml_num</code> for use in 09-hclust.Rmd</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html"><i class="fa fa-check"></i><b>10</b> Hierarchical Agglomerative Clustering</a>
<ul>
<li class="chapter" data-level="10.1" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#compare-different-dissimilarity-measures"><i class="fa fa-check"></i><b>10.1</b> Compare different dissimilarity measures</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#wards-method-minimum-variance-between-clusters"><i class="fa fa-check"></i><b>10.1.1</b> Ward’s method: minimum variance between clusters</a></li>
<li class="chapter" data-level="10.1.2" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#complete-linkage-largest-intercluster-difference"><i class="fa fa-check"></i><b>10.1.2</b> Complete linkage: largest intercluster difference</a></li>
<li class="chapter" data-level="10.1.3" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#single-linkage-smallest-intercluster-difference"><i class="fa fa-check"></i><b>10.1.3</b> Single linkage: smallest intercluster difference</a></li>
<li class="chapter" data-level="10.1.4" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#average-linkage-mean-intercluster-difference"><i class="fa fa-check"></i><b>10.1.4</b> Average linkage: mean intercluster difference</a></li>
<li class="chapter" data-level="10.1.5" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#view-summaries"><i class="fa fa-check"></i><b>10.1.5</b> View summaries</a></li>
<li class="chapter" data-level="10.1.6" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#plot-euclidean-distance-linkages"><i class="fa fa-check"></i><b>10.1.6</b> Plot Euclidean distance linkages</a></li>
<li class="chapter" data-level="10.1.7" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#view-standard-error-plots"><i class="fa fa-check"></i><b>10.1.7</b> View standard error plots:</a></li>
<li class="chapter" data-level="10.1.8" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#return-best-performing-model"><i class="fa fa-check"></i><b>10.1.8</b> Return best performing model</a></li>
<li class="chapter" data-level="10.1.9" data-path="hierarchical-agglomerative-clustering.html"><a href="hierarchical-agglomerative-clustering.html#cross-validated-mclust"><i class="fa fa-check"></i><b>10.1.9</b> Cross-validated mclust</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ols-and-lasso" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> OLS and lasso</h1>
<div id="load-packages" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="ols-and-lasso.html#cb1-1"></a><span class="kw">library</span>(glmnet)</span></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loaded glmnet 4.0-2</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="ols-and-lasso.html#cb4-1"></a><span class="kw">library</span>(rio) <span class="co"># painless data import and export</span></span>
<span id="cb4-2"><a href="ols-and-lasso.html#cb4-2"></a><span class="kw">library</span>(tidyverse) <span class="co"># tidyverse packages </span></span></code></pre></div>
<pre><code>## ── Attaching packages ──────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.3     ✓ dplyr   1.0.2
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ─────────────── tidyverse_conflicts() ──
## x tidyr::expand() masks Matrix::expand()
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## x tidyr::pack()   masks Matrix::pack()
## x tidyr::unpack() masks Matrix::unpack()</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="ols-and-lasso.html#cb8-1"></a><span class="kw">library</span>(tidymodels) <span class="co"># tidymodels framework </span></span></code></pre></div>
<pre><code>## ── Attaching packages ─────────── tidymodels 0.1.1 ──</code></pre>
<pre><code>## ✓ broom     0.7.0      ✓ recipes   0.1.13
## ✓ dials     0.0.9      ✓ rsample   0.0.7 
## ✓ infer     0.5.3      ✓ tune      0.1.1 
## ✓ modeldata 0.0.2      ✓ workflows 0.2.0 
## ✓ parsnip   0.1.3      ✓ yardstick 0.0.7</code></pre>
<pre><code>## ── Conflicts ────────────── tidymodels_conflicts() ──
## x scales::discard() masks purrr::discard()
## x tidyr::expand()   masks Matrix::expand()
## x dplyr::filter()   masks stats::filter()
## x recipes::fixed()  masks stringr::fixed()
## x dplyr::lag()      masks stats::lag()
## x tidyr::pack()     masks Matrix::pack()
## x yardstick::spec() masks readr::spec()
## x recipes::step()   masks stats::step()
## x tidyr::unpack()   masks Matrix::unpack()</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="ols-and-lasso.html#cb12-1"></a><span class="kw">library</span>(here) <span class="co"># reproducible way to find files </span></span></code></pre></div>
<pre><code>## here() starts at /home/jae/Machine-Learning-in-R</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="ols-and-lasso.html#cb14-1"></a><span class="kw">library</span>(glue) <span class="co"># glue strings and objects </span></span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;glue&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ols-and-lasso.html#cb17-1"></a><span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</span></code></pre></div>
</div>
<div id="load-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Load data</h2>
<p>Load <code>train_x_reg</code>, <code>train_y_reg</code>, <code>test_x_reg</code>, and <code>test_y_reg</code> variables we defined in 02-preprocessing.Rmd for the OLS and Lasso <em>regression</em> tasks.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="ols-and-lasso.html#cb18-1"></a><span class="co"># Objects: task_reg, task_class</span></span>
<span id="cb18-2"><a href="ols-and-lasso.html#cb18-2"></a><span class="kw">load</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;preprocessed.RData&quot;</span>))</span></code></pre></div>
</div>
<div id="overview" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Overview</h2>
<ul>
<li><p>LASSO = sets Beta coefficients of unrelated (to Y) predictors to zero</p></li>
<li><p>RIDGE = sets Beta coefficients of unrelated (to Y) predictors NEAR ZERO but does not remove them</p></li>
<li><p>ELASTICNET = a combination of LASSO and RIDGE</p></li>
</ul>
<p>Review “Challenge 0” in the Challenges folder for a useful review of how OLS regression works and <a href="http://blog.yhat.com/posts/r-lm-summary.html">see the yhat blog</a> for help interpreting its output.</p>
<p>Linear regression is a useful introduction to machine learning, but in your research you might be faced with warning messages after <code>predict()</code> about the <a href="https://stats.stackexchange.com/questions/35071/what-is-rank-deficiency-and-how-to-deal-with-it">rank of your matrix</a>.</p>
<p>The lasso is useful to try and remove some of the non-associated features from the model. Because glmnet expects a matrix of predictors, use <code>as.matrix</code> to convert it from a data frame to a matrix. (You don’t need to worry about this, if you use <code>tidymodels</code>.)</p>
<p>Be sure to <a href="https://web.stanford.edu/~hastie/Papers/Glmnet_Vignette.pdf">read the glmnet vignette</a></p>
</div>
<div id="fit-and-evaluate-models" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Fit and evaluate models</h2>
<div id="non-tidy" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Non-tidy</h3>
<div id="ols" class="section level4" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> OLS</h4>
<p>Below is an refresher of ordinary least squares linear (OLS) regression that predicts age using the other variables as predictors.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="ols-and-lasso.html#cb19-1"></a><span class="co"># Fit the regression model; lm() will automatically add a temporary intercept column</span></span>
<span id="cb19-2"><a href="ols-and-lasso.html#cb19-2"></a>ols &lt;-<span class="st"> </span><span class="kw">lm</span>(train_y_reg <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_x_reg)</span>
<span id="cb19-3"><a href="ols-and-lasso.html#cb19-3"></a></span>
<span id="cb19-4"><a href="ols-and-lasso.html#cb19-4"></a><span class="co"># Predict outcome for the test data</span></span>
<span id="cb19-5"><a href="ols-and-lasso.html#cb19-5"></a>ols_predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(ols, test_x_reg)</span>
<span id="cb19-6"><a href="ols-and-lasso.html#cb19-6"></a></span>
<span id="cb19-7"><a href="ols-and-lasso.html#cb19-7"></a><span class="co"># Root mean-squared error</span></span>
<span id="cb19-8"><a href="ols-and-lasso.html#cb19-8"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((test_y_reg <span class="op">-</span><span class="st"> </span>ols_predicted )<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 8.074011</code></pre>
</div>
<div id="lasso" class="section level4" number="4.4.1.2">
<h4><span class="header-section-number">4.4.1.2</span> Lasso</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="ols-and-lasso.html#cb21-1"></a><span class="co"># Fit the lasso model </span></span>
<span id="cb21-2"><a href="ols-and-lasso.html#cb21-2"></a>lasso &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(<span class="dt">x =</span> <span class="kw">as.matrix</span>(train_x_reg), </span>
<span id="cb21-3"><a href="ols-and-lasso.html#cb21-3"></a>                   <span class="dt">y =</span> train_y_reg, </span>
<span id="cb21-4"><a href="ols-and-lasso.html#cb21-4"></a>                   <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, </span>
<span id="cb21-5"><a href="ols-and-lasso.html#cb21-5"></a>                   <span class="dt">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb21-6"><a href="ols-and-lasso.html#cb21-6"></a></span>
<span id="cb21-7"><a href="ols-and-lasso.html#cb21-7"></a>lasso<span class="op">$</span>lambda.min</span></code></pre></div>
<pre><code>## [1] 0.4194076</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="ols-and-lasso.html#cb23-1"></a><span class="co"># Predict outcome for the test data</span></span>
<span id="cb23-2"><a href="ols-and-lasso.html#cb23-2"></a>lasso_predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(lasso, <span class="dt">newx =</span> <span class="kw">as.matrix</span>(test_x_reg),</span>
<span id="cb23-3"><a href="ols-and-lasso.html#cb23-3"></a>                      <span class="dt">s =</span> <span class="fl">0.1</span>) <span class="co"># Tuning parameter </span></span>
<span id="cb23-4"><a href="ols-and-lasso.html#cb23-4"></a></span>
<span id="cb23-5"><a href="ols-and-lasso.html#cb23-5"></a><span class="co"># Calculate root mean-squared error</span></span>
<span id="cb23-6"><a href="ols-and-lasso.html#cb23-6"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((lasso_predicted <span class="op">-</span><span class="st"> </span>test_y_reg)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 7.858063</code></pre>
</div>
</div>
<div id="tidymodels" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> tidymodels</h3>
<div id="parsnip" class="section level4" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> parsnip</h4>
<ul>
<li>Build models</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="ols-and-lasso.html#cb25-1"></a><span class="co"># OLS spec </span></span>
<span id="cb25-2"><a href="ols-and-lasso.html#cb25-2"></a>ols_spec &lt;-<span class="st"> </span><span class="kw">linear_reg</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Specify the model </span></span>
<span id="cb25-3"><a href="ols-and-lasso.html#cb25-3"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Specify the engine: lm, glmnet, stan, keras, spark </span></span>
<span id="cb25-4"><a href="ols-and-lasso.html#cb25-4"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="co"># Declare the mode: regression or classification </span></span>
<span id="cb25-5"><a href="ols-and-lasso.html#cb25-5"></a></span>
<span id="cb25-6"><a href="ols-and-lasso.html#cb25-6"></a><span class="co"># Lasso spec </span></span>
<span id="cb25-7"><a href="ols-and-lasso.html#cb25-7"></a>lasso_spec &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(<span class="dt">penalty =</span> <span class="fl">0.1</span>, <span class="co"># tuning parameter </span></span>
<span id="cb25-8"><a href="ols-and-lasso.html#cb25-8"></a>                         <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 1 = lasso, 0 = ridge </span></span>
<span id="cb25-9"><a href="ols-and-lasso.html#cb25-9"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-10"><a href="ols-and-lasso.html#cb25-10"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) </span>
<span id="cb25-11"><a href="ols-and-lasso.html#cb25-11"></a></span>
<span id="cb25-12"><a href="ols-and-lasso.html#cb25-12"></a><span class="co"># If you don&#39;t understand parsnip arguments </span></span>
<span id="cb25-13"><a href="ols-and-lasso.html#cb25-13"></a>lasso_spec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">translate</span>() <span class="co"># See the documentation </span></span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.1
##   mixture = 1
## 
## Computational engine: glmnet 
## 
## Model fit template:
## glmnet::glmnet(x = missing_arg(), y = missing_arg(), weights = missing_arg(), 
##     alpha = 1, family = &quot;gaussian&quot;)</code></pre>
<ul>
<li>Fit models</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="ols-and-lasso.html#cb27-1"></a>ols_fit &lt;-<span class="st"> </span>ols_spec <span class="op">%&gt;%</span></span>
<span id="cb27-2"><a href="ols-and-lasso.html#cb27-2"></a><span class="st">  </span><span class="kw">fit_xy</span>(<span class="dt">x =</span> train_x_reg, <span class="dt">y=</span> train_y_reg) </span>
<span id="cb27-3"><a href="ols-and-lasso.html#cb27-3"></a>  <span class="co"># fit(train_y_reg ~ ., train_x_reg) # When you data are not preprocessed </span></span>
<span id="cb27-4"><a href="ols-and-lasso.html#cb27-4"></a></span>
<span id="cb27-5"><a href="ols-and-lasso.html#cb27-5"></a>lasso_fit &lt;-<span class="st"> </span>lasso_spec <span class="op">%&gt;%</span></span>
<span id="cb27-6"><a href="ols-and-lasso.html#cb27-6"></a><span class="st">  </span><span class="kw">fit_xy</span>(<span class="dt">x =</span> train_x_reg, <span class="dt">y=</span> train_y_reg) </span></code></pre></div>
</div>
<div id="yardstick" class="section level4" number="4.4.2.2">
<h4><span class="header-section-number">4.4.2.2</span> yardstick</h4>
<ul>
<li>Evaluate prediction performance</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="ols-and-lasso.html#cb28-1"></a><span class="co"># Visualize model fit</span></span>
<span id="cb28-2"><a href="ols-and-lasso.html#cb28-2"></a>visualize_fit &lt;-<span class="st"> </span><span class="cf">function</span>(model, names){</span>
<span id="cb28-3"><a href="ols-and-lasso.html#cb28-3"></a>  </span>
<span id="cb28-4"><a href="ols-and-lasso.html#cb28-4"></a>  <span class="co"># Bind ground truth and predicted values  </span></span>
<span id="cb28-5"><a href="ols-and-lasso.html#cb28-5"></a>  <span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">truth =</span> test_y_reg), <span class="co"># Ground truth </span></span>
<span id="cb28-6"><a href="ols-and-lasso.html#cb28-6"></a>            <span class="kw">predict</span>(model, test_x_reg)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Predicted values </span></span>
<span id="cb28-7"><a href="ols-and-lasso.html#cb28-7"></a><span class="st">  </span></span>
<span id="cb28-8"><a href="ols-and-lasso.html#cb28-8"></a><span class="st">  </span><span class="co"># Visualize the residuals </span></span>
<span id="cb28-9"><a href="ols-and-lasso.html#cb28-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> truth, <span class="dt">y =</span> .pred)) <span class="op">+</span></span>
<span id="cb28-10"><a href="ols-and-lasso.html#cb28-10"></a><span class="st">    </span><span class="co"># Diagonal line </span></span>
<span id="cb28-11"><a href="ols-and-lasso.html#cb28-11"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb28-12"><a href="ols-and-lasso.html#cb28-12"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb28-13"><a href="ols-and-lasso.html#cb28-13"></a><span class="st">    </span><span class="co"># Make X- and Y- scale uniform </span></span>
<span id="cb28-14"><a href="ols-and-lasso.html#cb28-14"></a><span class="st">    </span><span class="kw">coord_obs_pred</span>() <span class="op">+</span></span>
<span id="cb28-15"><a href="ols-and-lasso.html#cb28-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&quot;{names}&quot;</span>))</span>
<span id="cb28-16"><a href="ols-and-lasso.html#cb28-16"></a></span>
<span id="cb28-17"><a href="ols-and-lasso.html#cb28-17"></a>}</span>
<span id="cb28-18"><a href="ols-and-lasso.html#cb28-18"></a></span>
<span id="cb28-19"><a href="ols-and-lasso.html#cb28-19"></a><span class="kw">map2</span>(<span class="kw">list</span>(ols_fit, lasso_fit), <span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), visualize_fit) </span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="ols-and-lasso.html#cb31-1"></a><span class="co"># Define performance metrics </span></span>
<span id="cb31-2"><a href="ols-and-lasso.html#cb31-2"></a>metrics &lt;-<span class="st"> </span>yardstick<span class="op">::</span><span class="kw">metric_set</span>(rmse, rsq, mae)</span>
<span id="cb31-3"><a href="ols-and-lasso.html#cb31-3"></a></span>
<span id="cb31-4"><a href="ols-and-lasso.html#cb31-4"></a><span class="co"># Build an evaluation function </span></span>
<span id="cb31-5"><a href="ols-and-lasso.html#cb31-5"></a>evaluate_model &lt;-<span class="st"> </span><span class="cf">function</span>(model){</span>
<span id="cb31-6"><a href="ols-and-lasso.html#cb31-6"></a>  </span>
<span id="cb31-7"><a href="ols-and-lasso.html#cb31-7"></a>  <span class="co"># Bind ground truth and predicted values  </span></span>
<span id="cb31-8"><a href="ols-and-lasso.html#cb31-8"></a>  <span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">truth =</span> test_y_reg), <span class="co"># Ground truth </span></span>
<span id="cb31-9"><a href="ols-and-lasso.html#cb31-9"></a>            <span class="kw">predict</span>(model, test_x_reg)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Predicted values </span></span>
<span id="cb31-10"><a href="ols-and-lasso.html#cb31-10"></a><span class="st">    </span></span>
<span id="cb31-11"><a href="ols-and-lasso.html#cb31-11"></a><span class="st">  </span><span class="co"># Calculate root mean-squared error</span></span>
<span id="cb31-12"><a href="ols-and-lasso.html#cb31-12"></a><span class="st">  </span><span class="kw">metrics</span>(<span class="dt">truth =</span> truth, <span class="dt">estimate =</span> .pred) </span>
<span id="cb31-13"><a href="ols-and-lasso.html#cb31-13"></a>  }</span>
<span id="cb31-14"><a href="ols-and-lasso.html#cb31-14"></a></span>
<span id="cb31-15"><a href="ols-and-lasso.html#cb31-15"></a><span class="co"># Evaluate many models </span></span>
<span id="cb31-16"><a href="ols-and-lasso.html#cb31-16"></a>evals &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="kw">list</span>(ols_fit, lasso_fit), evaluate_model) <span class="op">%&gt;%</span></span>
<span id="cb31-17"><a href="ols-and-lasso.html#cb31-17"></a><span class="st">  </span><span class="kw">reduce</span>(bind_rows) <span class="op">%&gt;%</span></span>
<span id="cb31-18"><a href="ols-and-lasso.html#cb31-18"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), <span class="dt">each =</span> <span class="dv">3</span>))</span>
<span id="cb31-19"><a href="ols-and-lasso.html#cb31-19"></a></span>
<span id="cb31-20"><a href="ols-and-lasso.html#cb31-20"></a><span class="co"># Visualize the test results </span></span>
<span id="cb31-21"><a href="ols-and-lasso.html#cb31-21"></a>evals <span class="op">%&gt;%</span></span>
<span id="cb31-22"><a href="ols-and-lasso.html#cb31-22"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(type, .estimate), <span class="dt">y =</span> .estimate)) <span class="op">+</span></span>
<span id="cb31-23"><a href="ols-and-lasso.html#cb31-23"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb31-24"><a href="ols-and-lasso.html#cb31-24"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb31-25"><a href="ols-and-lasso.html#cb31-25"></a>         <span class="dt">y =</span> <span class="st">&quot;Estimate&quot;</span>) <span class="op">+</span></span>
<span id="cb31-26"><a href="ols-and-lasso.html#cb31-26"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="kw">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>), <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) </span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="tuning-parameters" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Tuning parameters</h2>
<p>Visualize the distribution of log(lamba) vs mean-squared error.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="ols-and-lasso.html#cb32-1"></a><span class="kw">plot</span>(lasso) </span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="ols-and-lasso.html#cb33-1"></a><span class="co"># Help interpreting this plot: https://stats.stackexchange.com/questions/404795/interpretation-of-cross-validation-plot-for-lasso-regression</span></span>
<span id="cb33-2"><a href="ols-and-lasso.html#cb33-2"></a></span>
<span id="cb33-3"><a href="ols-and-lasso.html#cb33-3"></a><span class="co"># Generate our own version, but plot lambda (not on log scale) vs. RMSE.</span></span>
<span id="cb33-4"><a href="ols-and-lasso.html#cb33-4"></a><span class="kw">qplot</span>(lasso<span class="op">$</span>lambda, <span class="kw">sqrt</span>(lasso<span class="op">$</span>cvm)) </span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<blockquote>
<p>NOTE: when log(lamba) is equal to 0 that means lambda is equal to 1. In this graph, the far right side is overpenalized, as the model is emphasizing the beta coefficients being small. As log(lambda) becomes increasingly negative, lambda is correspondingly closer to zero and we are approaching the OLS solution.</p>
</blockquote>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="ols-and-lasso.html#cb34-1"></a><span class="co"># And here is a plot of log(lambda) vs lambda.</span></span>
<span id="cb34-2"><a href="ols-and-lasso.html#cb34-2"></a><span class="kw">qplot</span>(<span class="kw">log</span>(lasso<span class="op">$</span>lambda), lasso<span class="op">$</span>lambda) </span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Show plot of different lambda values:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="ols-and-lasso.html#cb35-1"></a><span class="kw">plot</span>(lasso<span class="op">$</span>glmnet.fit, <span class="dt">xvar =</span> <span class="st">&quot;lambda&quot;</span>, <span class="dt">label =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Show the lambda that results in the minimum estimated mean-squared error (MSE):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="ols-and-lasso.html#cb36-1"></a>lasso<span class="op">$</span>lambda.min</span></code></pre></div>
<pre><code>## [1] 0.4194076</code></pre>
<p>Show higher lambda within <a href="https://stats.stackexchange.com/questions/80268/empirical-justification-for-the-one-standard-error-rule-when-using-cross-validat">one standard error</a> of performance of the minimum</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ols-and-lasso.html#cb38-1"></a>lasso<span class="op">$</span>lambda<span class="fl">.1</span>se</span></code></pre></div>
<pre><code>## [1] 1.167027</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ols-and-lasso.html#cb40-1"></a><span class="co"># Log scale versions:</span></span>
<span id="cb40-2"><a href="ols-and-lasso.html#cb40-2"></a><span class="kw">log</span>(<span class="kw">c</span>(<span class="st">&quot;log_min&quot;</span> =<span class="st"> </span>lasso<span class="op">$</span>lambda.min, <span class="st">&quot;log_1se&quot;</span> =<span class="st"> </span>lasso<span class="op">$</span>lambda<span class="fl">.1</span>se))</span></code></pre></div>
<pre><code>##    log_min    log_1se 
## -0.8689121  0.1544591</code></pre>
<p>Look at the coefficients</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ols-and-lasso.html#cb42-1"></a>(<span class="dt">coef_1se =</span> <span class="kw">coef</span>(lasso, <span class="dt">s =</span> <span class="st">&quot;lambda.1se&quot;</span>))</span></code></pre></div>
<pre><code>## 22 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                        1
## (Intercept) 60.296179264
## trestbps     0.071877196
## chol         0.006372491
## fbs          .          
## restecg      .          
## thalach     -0.112828872
## exang        .          
## oldpeak      .          
## target       .          
## sex_X1       .          
## ca_X1        .          
## ca_X2        1.669594563
## ca_X3        .          
## ca_X4       -0.634474556
## cp_X1        .          
## cp_X2        .          
## cp_X3        .          
## slope_X1     .          
## slope_X2     .          
## thal_X1      .          
## thal_X2      .          
## thal_X3      .</code></pre>
<p>Look at the coefficients for lambda.min</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="ols-and-lasso.html#cb44-1"></a>(<span class="dt">coef_min =</span> <span class="kw">coef</span>(lasso, <span class="dt">s =</span> <span class="st">&quot;lambda.min&quot;</span>))</span></code></pre></div>
<pre><code>## 22 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                       1
## (Intercept) 55.66199020
## trestbps     0.11015680
## chol         0.01309444
## fbs          .         
## restecg     -0.35221266
## thalach     -0.12678780
## exang       -0.17134774
## oldpeak      .         
## target       .         
## sex_X1      -0.94868280
## ca_X1        2.07593388
## ca_X2        4.41461473
## ca_X3        3.15152379
## ca_X4       -4.41342359
## cp_X1        .         
## cp_X2        .         
## cp_X3        .         
## slope_X1     .         
## slope_X2     .         
## thal_X1      .         
## thal_X2      .         
## thal_X3      .</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="ols-and-lasso.html#cb46-1"></a><span class="co"># Compare side-by-side</span></span>
<span id="cb46-2"><a href="ols-and-lasso.html#cb46-2"></a><span class="kw">cbind</span>(<span class="kw">as.matrix</span>(coef_1se), <span class="kw">as.matrix</span>(coef_min))</span></code></pre></div>
<pre><code>##                        1           1
## (Intercept) 60.296179264 55.66199020
## trestbps     0.071877196  0.11015680
## chol         0.006372491  0.01309444
## fbs          0.000000000  0.00000000
## restecg      0.000000000 -0.35221266
## thalach     -0.112828872 -0.12678780
## exang        0.000000000 -0.17134774
## oldpeak      0.000000000  0.00000000
## target       0.000000000  0.00000000
## sex_X1       0.000000000 -0.94868280
## ca_X1        0.000000000  2.07593388
## ca_X2        1.669594563  4.41461473
## ca_X3        0.000000000  3.15152379
## ca_X4       -0.634474556 -4.41342359
## cp_X1        0.000000000  0.00000000
## cp_X2        0.000000000  0.00000000
## cp_X3        0.000000000  0.00000000
## slope_X1     0.000000000  0.00000000
## slope_X2     0.000000000  0.00000000
## thal_X1      0.000000000  0.00000000
## thal_X2      0.000000000  0.00000000
## thal_X3      0.000000000  0.00000000</code></pre>
<p>Predict on the test set</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="ols-and-lasso.html#cb48-1"></a>predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(lasso, <span class="dt">newx =</span> <span class="kw">as.matrix</span>(test_x_reg),</span>
<span id="cb48-2"><a href="ols-and-lasso.html#cb48-2"></a>                      <span class="dt">s =</span> lasso<span class="op">$</span>lambda<span class="fl">.1</span>se)</span>
<span id="cb48-3"><a href="ols-and-lasso.html#cb48-3"></a></span>
<span id="cb48-4"><a href="ols-and-lasso.html#cb48-4"></a><span class="co"># How far off were we, based on absolute error?</span></span>
<span id="cb48-5"><a href="ols-and-lasso.html#cb48-5"></a>rounded_errors &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">abs</span>(test_y_reg <span class="op">-</span><span class="st"> </span>predictions))</span>
<span id="cb48-6"><a href="ols-and-lasso.html#cb48-6"></a><span class="kw">table</span>(rounded_errors)</span></code></pre></div>
<pre><code>## rounded_errors
##  0  1  2  3  4  5  6  7  8  9 10 11 12 14 15 16 17 21 
##  4  9  5  7  7  5  8  9  9  1  7  5  3  4  1  4  1  1</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="ols-and-lasso.html#cb50-1"></a><span class="co"># Group the absolute error into 4 bins.</span></span>
<span id="cb50-2"><a href="ols-and-lasso.html#cb50-2"></a>grouped_errors &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">abs</span>(test_y_reg <span class="op">-</span><span class="st"> </span>predictions) <span class="op">/</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb50-3"><a href="ols-and-lasso.html#cb50-3"></a>grouped_errors[grouped_errors <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>] =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb50-4"><a href="ols-and-lasso.html#cb50-4"></a><span class="kw">table</span>(grouped_errors)</span></code></pre></div>
<pre><code>## grouped_errors
##  0  1  2  3 
## 18 36 25 11</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="ols-and-lasso.html#cb52-1"></a><span class="co"># 4 categories of accuracy</span></span>
<span id="cb52-2"><a href="ols-and-lasso.html#cb52-2"></a>how_close &lt;-<span class="st"> </span><span class="kw">factor</span>(grouped_errors, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;very close&quot;</span>, <span class="st">&quot;close&quot;</span>, <span class="st">&quot;meh&quot;</span>, <span class="st">&quot;far&quot;</span>))</span>
<span id="cb52-3"><a href="ols-and-lasso.html#cb52-3"></a></span>
<span id="cb52-4"><a href="ols-and-lasso.html#cb52-4"></a><span class="kw">table</span>(rounded_errors, how_close)</span></code></pre></div>
<pre><code>##               how_close
## rounded_errors very close close meh far
##             0           4     0   0   0
##             1           9     0   0   0
##             2           5     0   0   0
##             3           0     7   0   0
##             4           0     7   0   0
##             5           0     5   0   0
##             6           0     8   0   0
##             7           0     9   0   0
##             8           0     0   9   0
##             9           0     0   1   0
##             10          0     0   7   0
##             11          0     0   5   0
##             12          0     0   3   0
##             14          0     0   0   4
##             15          0     0   0   1
##             16          0     0   0   4
##             17          0     0   0   1
##             21          0     0   0   1</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="ols-and-lasso.html#cb54-1"></a><span class="co"># Scatter plot of actual vs. predicted</span></span>
<span id="cb54-2"><a href="ols-and-lasso.html#cb54-2"></a><span class="kw">qplot</span>(test_y_reg, predictions, </span>
<span id="cb54-3"><a href="ols-and-lasso.html#cb54-3"></a>      <span class="dt">color =</span> how_close) <span class="op">+</span></span>
<span id="cb54-4"><a href="ols-and-lasso.html#cb54-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) </span></code></pre></div>
<p><img src="machine-learning-in-r_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Calculate MSE and RMSE:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="ols-and-lasso.html#cb55-1"></a><span class="co"># Calculate mean-squared error.</span></span>
<span id="cb55-2"><a href="ols-and-lasso.html#cb55-2"></a><span class="kw">mean</span>((predictions <span class="op">-</span><span class="st"> </span>test_y_reg)<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 68.94235</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="ols-and-lasso.html#cb57-1"></a><span class="co"># Calculate root mean-squared error.</span></span>
<span id="cb57-2"><a href="ols-and-lasso.html#cb57-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((predictions <span class="op">-</span><span class="st"> </span>test_y_reg)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 8.303153</code></pre>
</div>
<div id="challenge-1" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Challenge 1</h2>
<p>Open Challenge 1 in the “Challenges” folder.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preprocessing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="decision-trees.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dlab-berkeley/Machine-Learning-in-R/edit/master/03-lasso.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["machine-learning-in-r.pdf", "machine-learning-in-r.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
